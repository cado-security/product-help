<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-cado-response/deploy/aws/iam/tightening-iam" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">Removing and Tightening IAM Permissions | Cado Security</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.cadosecurity.com/cado-response/deploy/aws/iam/tightening-iam"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="google-site-verification" content="j1fUKfw-LfBrYqXusMAoBbmCW8nSNobe8nOyfDl6xAY"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Removing and Tightening IAM Permissions | Cado Security"><meta data-rh="true" name="description" content="Removing and Tightening IAM Permissions"><meta data-rh="true" property="og:description" content="Removing and Tightening IAM Permissions"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.cadosecurity.com/cado-response/deploy/aws/iam/tightening-iam"><link data-rh="true" rel="alternate" href="https://docs.cadosecurity.com/cado-response/deploy/aws/iam/tightening-iam" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.cadosecurity.com/cado-response/deploy/aws/iam/tightening-iam" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9BVXSKWB6Z"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-9BVXSKWB6Z",{})</script><link rel="stylesheet" href="/assets/css/styles.41c6a14a.css">
<script src="/assets/js/runtime~main.28bd2a4f.js" defer="defer"></script>
<script src="/assets/js/main.44866264.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/cado.png" alt="Cado Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/cado-dark.png" alt="Cado Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"> </b></a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/cado-response/intro">Cado Platform</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cado-response/intro">Summary</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cado-response/key-concepts">Key Concepts</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/cado-response/deploy/intro">Deployment</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cado-response/deploy/intro">Deployment Options</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/cado-response/deploy/aws/overview">AWS</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/cado-response/deploy/aws/overview">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/cado-response/deploy/aws/iam/deployment-iam-considerations">IAM Considerations</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/cado-response/deploy/aws/iam/deployment-iam-considerations">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/cado-response/deploy/aws/iam/aws-kms">KMS Support</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/cado-response/deploy/aws/iam/tightening-iam">Removing and Tightening IAM Permissions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/cado-response/deploy/aws/iam/cross-account-creation">Cross Account Creation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/cado-response/deploy/aws/iam/aws-organizations">AWS Organizations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/cado-response/deploy/aws/iam/cross-cloud">Adding Azure and GCP to AWS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/cado-response/deploy/aws/iam/temporary-credentials">Temporary Credentials with STS</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" tabindex="0" href="/cado-response/deploy/aws/security/platform-security">Platform Security</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/cado-response/deploy/aws/security/platform-security">Best Practices</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/cado-response/deploy/aws/security/logging">Logging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/cado-response/deploy/aws/security/data-encryption-overview">Encryption</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" tabindex="0" href="/cado-response/deploy/aws/networking/aws-load-balancer">Networking</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/cado-response/deploy/aws/networking/aws-load-balancer">Load Balancer and SSL</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/cado-response/deploy/aws/networking/internet-routable-addresses">Private IP Addresses</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" tabindex="0" href="/cado-response/deploy/aws/performance-resiliency/aws-backups">Performance and Resiliency</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/cado-response/deploy/aws/performance-resiliency/aws-backups">Backups and Recovery</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/cado-response/deploy/aws/performance-resiliency/large-aws-imports">Large EC2 Imports</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/cado-response/deploy/aws/performance-resiliency/high-availability">High Availability</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/cado-response/deploy/azure/azure-deploy">Azure</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/cado-response/deploy/gcp/gcp-deploy">GCP</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cado-response/deploy/kubernetes">Kubernetes Deployments</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/cado-response/discovery-import/intro">Import</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/cado-response/export/intro">Export</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/cado-response/investigate/intro">Investigating</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/cado-response/manage/logging-in">Manage</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/cado-response/community-edition/community-intro">Community Edition</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/cado-host/intro">Cado Host</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/troubleshooting/faq">Troubleshooting</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/eula/commercial-eula">License Agreements</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/support-bulletins/role-update">Support Bulletins</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/release-notes">Release Notes</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Cado Platform</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Deployment</span><meta itemprop="position" content="2"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">AWS</span><meta itemprop="position" content="3"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">IAM Considerations</span><meta itemprop="position" content="4"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Removing and Tightening IAM Permissions</span><meta itemprop="position" content="5"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="removing-and-tightening-iam-permissions">Removing and Tightening IAM Permissions<a href="#removing-and-tightening-iam-permissions" class="hash-link" aria-label="Direct link to Removing and Tightening IAM Permissions" title="Direct link to Removing and Tightening IAM Permissions">​</a></h2>
<p>You can further tune the IAM permissions that Cado deploys if you do not require all functionality. We describe the functionality used by the permissions in the “Sid” section of the <a href="https://github.com/cado-security/Deployment-Templates/blob/main/cross-account/CrossAccountPolicy.yaml" target="_blank" rel="noopener noreferrer">cross-account role</a>. Please contact <a href="mailto:support@cadosecurity.com" target="_blank" rel="noopener noreferrer">support@cadosecurity.com</a> for advice on what permissions are required for.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-tighten-iam-permissions-for-ssm">How to tighten IAM Permissions for SSM<a href="#how-to-tighten-iam-permissions-for-ssm" class="hash-link" aria-label="Direct link to How to tighten IAM Permissions for SSM" title="Direct link to How to tighten IAM Permissions for SSM">​</a></h2>
<p>The Cado platform uses AWS SSM to perform live captures of AWS EC2 systems - this provides for a faster mechanism than a full disk acquisition and can also collect process memory.</p>
<p>However, the default IAM permissions will be too wide for many environments, as this provides the Cado platform with permission to execute any command on SSM enabled systems:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Sid&quot;: &quot;RequiredForTriageAndRunCommand&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Effect&quot;: &quot;Allow&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Action&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;ssm:SendCommand&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;ssm:DescribeInstanceInformation&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;Resource&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;arn:aws:ec2:*:*:instance/*&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;arn:aws:ssm:*::document/AWS-RunShellScript&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;arn:aws:ssm:*::document/AWS-RunPowerShellScript&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You may wish to scope these permissions down, so SSM commands can only be run against specific Instances. The easiest way to do this, is by adding a Tag Condition to the targeted EC2 resources:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;Sid&quot;: &quot;RequiredForTriageAndRunCommandTagged&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;Effect&quot;: &quot;Allow&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;Action&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;ssm:SendCommand&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;ssm:DescribeInstanceInformation&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;Resource&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;arn:aws:ec2:*:*:instance/*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;Condition&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;StringLike&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;ssm:resourceTag/CadoResponseSSMEnabled&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &quot;True&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;Sid&quot;: &quot;RequiredForTriageAndRunCommandRun&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;Effect&quot;: &quot;Allow&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;Action&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;ssm:SendCommand&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;ssm:DescribeInstanceInformation&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;Resource&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;arn:aws:ssm:*::document/AWS-RunShellScript&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;arn:aws:ssm:*::document/AWS-RunPowerShellScript&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Then adding the tag to the specific EC2 you wish to access with SSM:
<img loading="lazy" alt="IAM" src="/assets/images/ssm_tag-2de7a9a0e47b507498f19f3d125fdf16.png" width="1662" height="822" class="img_ev3q"></p>
<p>If an EC2 you are acquiring with SSM does not have the required Tag, you will receive an error such as:
An error occurred (AccessDeniedException) when calling the SendCommand operation: User: xxx is not authorized to perform: ssm<!-- -->:SendCommand<!-- --> on resource: i-xxx because no identity-based policy allows the ssm<!-- -->:SendCommand<!-- --> action</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="scoping-down-kms-permissions-if-required">Scoping down KMS Permissions if Required<a href="#scoping-down-kms-permissions-if-required" class="hash-link" aria-label="Direct link to Scoping down KMS Permissions if Required" title="Direct link to Scoping down KMS Permissions if Required">​</a></h2>
<p>The Cado platform will import EC2 instances with encrypted volumes, provided that the appropriate permissions are given to the CadoResponseRole.<br>
<!-- -->This is granted by the default Cado IAM roles.
AWS provides default keys in each AWS account. The default Cado IAM permissions support decryption of these KMS keys out of the box.
Cado supports Custom KMS Keys as well.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="kms-consideration---custom-keys">KMS Consideration - Custom Keys<a href="#kms-consideration---custom-keys" class="hash-link" aria-label="Direct link to KMS Consideration - Custom Keys" title="Direct link to KMS Consideration - Custom Keys">​</a></h3>
<p>When using custom keys the required actions to the CadoResponseRole are:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;kms:Encrypt&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;kms:Decrypt&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;kms:ReEncrypt*&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;kms:GenerateDataKey*&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;kms:CreateGrant&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You may choose to forgo giving all the permissions and only provide kms<!-- -->:CreateGrant<!-- --> to the CadoResponseRole.
This is recommended if the goal is simplicity, especially when there are cross account or cross region considerations.</p>
<p>When Cado performs a default KMS encrypted import across account, it will re-encrypt to a temporary key that is used to move snapshots cross-account.
An alias with a Cado prefix is used for scoping purposes, and the alias and key are scheduled for deletion after the import has finished.</p>
<p>You can give required permissions to the CadoResponseRole directly and withhold CreateGrant for resources only</p>
<ul>
<li>You may not wish to give kms<!-- -->:CreateGrant<!-- --> permission to the CadoResponseRole itself</li>
<li>Your policy must feature a statement which provides access to the CadoResponseRole with the above permissions (except CreateGrant)</li>
<li>You may then tighten the policy to only allow CreateGrant permission to only certain AWS resources</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="kms-considerations---cross-region--cross-account">KMS Considerations - Cross Region / Cross Account<a href="#kms-considerations---cross-region--cross-account" class="hash-link" aria-label="Direct link to KMS Considerations - Cross Region / Cross Account" title="Direct link to KMS Considerations - Cross Region / Cross Account">​</a></h3>
<p>Ensure that your relevant policy statements still apply to the region of your Cado platform (e.g. that policy Conditions don&#x27;t preclude the platform&#x27;s access).
For Cross Account, the simplest approach is to give kms<!-- -->:CreateGrant<!-- --> permissions to the role being assumed in the target account.
Alternatively the permissions in Custom Keys section are still valid, however both the primary and secondary account roles need to be accessible principals to &quot;kms<!-- -->:Encrypt<!-- -->&quot;, &quot;kms<!-- -->:Decrypt<!-- -->&quot;, &quot;kms<!-- -->:ReEncrypt<!-- -->*&quot;, kms<!-- -->:GenerateDataKey<!-- -->*&quot;</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="description-of-iam-permissions">Description of IAM Permissions<a href="#description-of-iam-permissions" class="hash-link" aria-label="Direct link to Description of IAM Permissions" title="Direct link to Description of IAM Permissions">​</a></h3>
<ul>
<li>Required,RequiredForStartup, RequiredForStartup2: Required for core platform operation and to start and stop workers.</li>
<li>RequiredForEC2ImportAndCorePlatform: Required to start and stop workers, and to acquire EC2 volumes</li>
<li>RequiredToCheckPolicy: Required for health checks to confirm the safe operation of the core platform</li>
<li>RequiredForCrossAccountAccess: Required when performing cross-account operations</li>
<li>RequiredToAccessCadoS3Bucket: Required to access the Cado S3 bucket, to store and access forensic data</li>
<li>RequiredForAcquireToS3: Required for forensic preservation to S3 buckets and chain of custody</li>
<li>RequiredForS3Readiness: Required to check safe operation of the platform</li>
<li>RequiredForMemoryForensics: Required to perform triage acquisitions via SSM that include memory acquisition</li>
<li>RequiredForKmsEncryptedEc2Import: Required when acquiring KMS encrypted EBS volumes for EC2 systems</li>
<li>RequiredForCrossAccountDefaultKmsEncryptedEc2Import: Required when acquiring KMS encrypted EBS volumes for EC2 systems from a different account</li>
<li>RequiredForOperationsOnTemporaryKMSResourcesduringDefaultEncryptedEc2Import: Required when acquiring KMS encrypted EBS volumes, by generating a key for re-encryption</li>
<li>RequiredForLambdaImport: Required to import Lambda functions. The Lambda permissions are required to acquire versions of the Lambda function, the Logs permission is for the CloudWatch logs, and the ecr permissions are required if the Lambda function is using a container image and you wish to acquire this. Container images are not required, but may include additional evidence such as malware or configuration data persisted in a malicious container.</li>
<li>RequiredForEcsImport: Required for ECS import. The ECS permissions are required to acquire the ECS cluster, services, and tasks. The ExecuteCommand permission is required to execute commands on the ECS tasks.</li>
<li>RequiredForEKSImport: Required for EKS import. The EKS permissions are required to acquire the EKS cluster.</li>
<li>RequiredForEc2ImportAndAmiImport: Required for EC2 and AMI import. The EC2 permissions are required to acquire the EC2 instances, volumes, and snapshots. The CloudTrail permissions are required to acquire the CloudTrail logs. The SSM permissions are required to acquire the SSM documents and instances. The IAM permissions are required to acquire the IAM roles and policies. The EC2 permissions are required to acquire the EC2 instances, volumes, and snapshots. The CloudTrail permissions are required to acquire the CloudTrail logs. The SSM permissions are required to acquire the SSM documents and instances. The IAM permissions are required to acquire the IAM roles and policies.</li>
<li>RequiredForEc2ImportAndAmiImport2: Required for EC2 and AMI imports, scoped to copied volumes created by Cado.</li>
<li>RequiredForResponseActionIsolateEc2: Required to isolate EC2 instances. If you are not using the isolation feature, this permission is not required.</li>
<li>RequiredForAmiImports: Required for AMI imports. This is scoped to the Cado copy of the AMI.</li>
<li>RequiredForHealthChecks: Required for health checks to confirm the safe operation of the core platform.</li>
<li>RequiredForNativeUpdatesWithALB: Required for native updates with ALB. This is not required if you are not using the ALB feature.</li>
<li>RequiredForGuardDutyMonitoring: Required for GuardDuty monitoring. This is not required if you are not using the GuardDuty automation feature.</li>
<li>RequiredForAutomatedErrorReporting: Required for automated error reporting. This is not required if you do not wish to send logs as needed to Cado, and are instead sharing logs manually.</li>
<li>RequiredForFirstTimeKMSDefaultencryptedImportCanBeDeletedAfter: This is used once to create a Cado KMS key to use for default encrypted EBS volumes. This is not required if you are not using the default encrypted EBS volume feature, and is only used once.</li>
<li>RequiredForAWSOrganizationsDiscoverAccounts: Required to discover accounts in AWS Organizations. This is not required if you are not using AWS Organizations.</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/cado-security/product-help/tree/master/docs/cado-response/deploy/aws/iam/tightening-iam.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2024-06-19T15:34:54.000Z">Jun 19, 2024</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/cado-response/deploy/aws/iam/aws-kms"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">KMS Support</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/cado-response/deploy/aws/iam/cross-account-creation"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Cross Account Creation</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#removing-and-tightening-iam-permissions" class="table-of-contents__link toc-highlight">Removing and Tightening IAM Permissions</a></li><li><a href="#how-to-tighten-iam-permissions-for-ssm" class="table-of-contents__link toc-highlight">How to tighten IAM Permissions for SSM</a></li><li><a href="#scoping-down-kms-permissions-if-required" class="table-of-contents__link toc-highlight">Scoping down KMS Permissions if Required</a><ul><li><a href="#kms-consideration---custom-keys" class="table-of-contents__link toc-highlight">KMS Consideration - Custom Keys</a></li><li><a href="#kms-considerations---cross-region--cross-account" class="table-of-contents__link toc-highlight">KMS Considerations - Cross Region / Cross Account</a></li><li><a href="#description-of-iam-permissions" class="table-of-contents__link toc-highlight">Description of IAM Permissions</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://twitter.com/cadosecurity" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/cado-security" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 | Cado Security</div></div></div></footer></div>
</body>
</html>