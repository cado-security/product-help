"use strict";(self.webpackChunkproduct_help=self.webpackChunkproduct_help||[]).push([[4084],{3905:(e,t,o)=>{o.d(t,{Zo:()=>d,kt:()=>m});var n=o(7294);function a(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function r(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function i(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?r(Object(o),!0).forEach((function(t){a(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function l(e,t){if(null==e)return{};var o,n,a=function(e,t){if(null==e)return{};var o,n,a={},r=Object.keys(e);for(n=0;n<r.length;n++)o=r[n],t.indexOf(o)>=0||(a[o]=e[o]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)o=r[n],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}var c=n.createContext({}),s=function(e){var t=n.useContext(c),o=t;return e&&(o="function"==typeof e?e(t):i(i({},t),e)),o},d=function(e){var t=s(e.components);return n.createElement(c.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var o=e.components,a=e.mdxType,r=e.originalType,c=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),u=s(o),m=a,h=u["".concat(c,".").concat(m)]||u[m]||p[m]||r;return o?n.createElement(h,i(i({ref:t},d),{},{components:o})):n.createElement(h,i({ref:t},d))}));function m(e,t){var o=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=o.length,i=new Array(r);i[0]=u;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var s=2;s<r;s++)i[s]=o[s];return n.createElement.apply(null,i)}return n.createElement.apply(null,o)}u.displayName="MDXCreateElement"},3762:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>p,frontMatter:()=>r,metadata:()=>l,toc:()=>s});var n=o(7462),a=(o(7294),o(3905));const r={title:"Overview",hide_title:!0,sidebar_position:1},i=void 0,l={unversionedId:"cado-response/deploy/gcp/gcp-settings",id:"cado-response/deploy/gcp/gcp-settings",title:"Overview",description:"GCP Import Settings",source:"@site/docs/cado-response/deploy/gcp/gcp-settings.md",sourceDirName:"cado-response/deploy/gcp",slug:"/cado-response/deploy/gcp/gcp-settings",permalink:"/cado-response/deploy/gcp/gcp-settings",draft:!1,editUrl:"https://github.com/cado-security/product-help/tree/master/docs/cado-response/deploy/gcp/gcp-settings.md",tags:[],version:"current",lastUpdatedAt:1673874904,formattedLastUpdatedAt:"Jan 16, 2023",sidebarPosition:1,frontMatter:{title:"Overview",hide_title:!0,sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Cross Subscription and Tenancy",permalink:"/cado-response/deploy/azure/azure-cross-tenancy-subscriptions"},next:{title:"Automation Rules (Beta)",permalink:"/cado-response/discovery-import/automation"}},c={},s=[{value:"GCP Import Settings",id:"gcp-import-settings",level:2},{value:"Entering Settings",id:"entering-settings",level:2},{value:"Getting GCP Credentials",id:"getting-gcp-credentials",level:2},{value:"Types of Credentials",id:"types-of-credentials",level:3},{value:"Service Accounts",id:"service-accounts",level:4},{value:"Expected Access",id:"expected-access",level:4},{value:"Workload Identity Federation",id:"workload-identity-federation",level:4}],d={toc:s};function p(e){let{components:t,...r}=e;return(0,a.kt)("wrapper",(0,n.Z)({},d,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"gcp-import-settings"},"GCP Import Settings"),(0,a.kt)("p",null,"You can acquire compute and storage resources from GCP with the Cado platform by configuring Cado with GCP credentials. The below guide walks through this process."),(0,a.kt)("h2",{id:"entering-settings"},"Entering Settings"),(0,a.kt)("p",null,"You can add GCP Credentials to Cado in the ",(0,a.kt)("strong",{parentName:"p"},"Settings > Cloud > GCP"),' page.\nYou will be asked for a "GCP Project Name" and the "GCP Credentials".'),(0,a.kt)("h2",{id:"getting-gcp-credentials"},"Getting GCP Credentials"),(0,a.kt)("p",null,"When you add credentials under Cado settings you are creating a mapping from a set of credentials (in GCP json format) to a project name."),(0,a.kt)("p",null,"Any time a user then attempts to access that particular GCP project name, the credentials that you registered in settings will be used. This keeps non-admin users from having to managing credentials themselves, while also alllowing access to as many different GCP projects as you want."),(0,a.kt)("p",null,"GCP credentials come in a json format that wraps around a \u2018regular\u2019 credential, for the benefit of the many different ways that a credential may be used on their end. It can be treated as functionally no different to how you would handle any type of password or key."),(0,a.kt)("p",null,"For example, a service account key might come in a structure such as the below. The \u2018credential\u2019 is a literal RSA key as a string in the ",(0,a.kt)("inlineCode",{parentName:"p"},"private_key")," field, all other fields are metadata for the benefit of the application that uses it:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'  {\n  "type": "service_account",\n  "project_id": "cool-project",\n  "private_key_id": "22c14ac5b63...",\n  "private_key": "-----BEGIN PRIVATE KEY-----\\nMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKg...wggSkA.\\n-----END PRIVATE KEY-----\\n",\n  "client_email": "cool-project.iam.gserviceaccount.com",\n  "client_id": "...",\n  "auth_uri": "https://accounts.google.com/o/oauth2/auth",\n  "token_uri": "https://oauth2.googleapis.com/token",\n  "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",\n  "client_x509_cert_url": "..."\n}\n')),(0,a.kt)("p",null,"Note that:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"The Cloud Build API (",(0,a.kt)("a",{parentName:"li",href:"https://console.cloud.google.com/cloud-build/"},"https://console.cloud.google.com/cloud-build/"),") needs to be enabled for the Project."),(0,a.kt)("li",{parentName:"ul"},"Each Service Account that is created by the service being acquired (e.g. Compute) requires the Editor role."),(0,a.kt)("li",{parentName:"ul"},"When you import an instance you first need to define a bucket for each GCP Project where the instance image will go - this bucket should be created during Cado install and will be used for future imports.")),(0,a.kt)("h3",{id:"types-of-credentials"},"Types of Credentials"),(0,a.kt)("h4",{id:"service-accounts"},"Service Accounts"),(0,a.kt)("p",null,"The simplest method to add GCP credentials to Cado is to use a service account, which will give you a permanent key. Naturally these are very sensitive but they are easy to manage and simple to set up. Adding GCP credntials for service accounts is supported by Cado when deployed in both AWS and Azure."),(0,a.kt)("p",null,"For more see:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://console.cloud.google.com/iam-admin/serviceaccounts"},"https://console.cloud.google.com/iam-admin/serviceaccounts")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://cloud.google.com/iam/docs/service-accounts"},"https://cloud.google.com/iam/docs/service-accounts"))),(0,a.kt)("h4",{id:"expected-access"},"Expected Access"),(0,a.kt)("p",null,"We expect the service account the Cado platform will authorize with has the 'Basic -> Editor' role:\n",(0,a.kt)("img",{alt:"Editor Role",src:o(5498).Z,width:"1551",height:"886"})),(0,a.kt)("h4",{id:"workload-identity-federation"},"Workload Identity Federation"),(0,a.kt)("p",null,"The GCP recommended best practice, however, is to use Workload Identity Federation, which allows credentials from another app to impersonate a GCP account. Workload Identity Federation is more secure since the credentials are nothing but metadata telling the app where to go, while the validation is handled on the server side. Adding GCP credentials via Workload Identity Federation is currently only supported for Cado when deployed in AWS."),(0,a.kt)("p",null,"Rather than give out the key to a service account, you instead register the permission with GCP to allow AWS credentials for account ",(0,a.kt)("inlineCode",{parentName:"p"},"123")," to act as if they were the given GCP service account."),(0,a.kt)("p",null,"You can download existing credentials by clicking the display name of the ",(0,a.kt)("strong",{parentName:"p"},"Identity Pool > Connected Service Accounts > Download"),", which will then ask you which identity\u2019s credentials you would like to download."),(0,a.kt)("p",null,"For example:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'{\n  "type": "external_account",\n  "audience": "//iam.googleapis.com/projects/...",\n  "subject_token_type": "urn:ietf:params:aws:token-type:aws4_request",\n  "service_account_impersonation_url": "https://...ount.comgenerateAccessToken",\n  "token_url": "https://sts.googleapis.com/v1/token",\n  "credential_source": {\n    "environment_id": "...",\n    "region_url": "http://169.254.169.254/latest/meta-data/placement/availability-zone",\n    "url": "http://169.254.169.254/latest/meta-data/iam/security-credentials",\n    "regional_cred_verification_url": "https://sts.{region}.amazonaws.com?Action=GetCallerIdentity&Version=2011-06-15"\n  }\n}\n')),(0,a.kt)("p",null,"For more see:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://console.cloud.google.com/iam-admin/workload-identity-pools"},"https://console.cloud.google.com/iam-admin/workload-identity-pools")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://cloud.google.com/iam/docs/workload-identity-federation"},"https://cloud.google.com/iam/docs/workload-identity-federation"))))}p.isMDXComponent=!0},5498:(e,t,o)=>{o.d(t,{Z:()=>n});const n=o.p+"assets/images/gcp-access-255f796c28cd88825212f7b41e99f9be.png"}}]);