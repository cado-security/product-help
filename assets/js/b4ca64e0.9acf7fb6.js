"use strict";(self.webpackChunkproduct_help=self.webpackChunkproduct_help||[]).push([[5e3],{9495:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>m,frontMatter:()=>t,metadata:()=>a,toc:()=>d});var o=s(5893),i=s(1151);const t={title:"Removing and Tightening IAM Permissions",hide_title:!0,sidebar_position:2},r=void 0,a={id:"cado-response/deploy/aws/iam/tightening-iam",title:"Removing and Tightening IAM Permissions",description:"Removing and Tightening IAM Permissions",source:"@site/docs/cado-response/deploy/aws/iam/tightening-iam.md",sourceDirName:"cado-response/deploy/aws/iam",slug:"/cado-response/deploy/aws/iam/tightening-iam",permalink:"/cado-response/deploy/aws/iam/tightening-iam",draft:!1,unlisted:!1,editUrl:"https://github.com/cado-security/product-help/tree/master/docs/cado-response/deploy/aws/iam/tightening-iam.md",tags:[],version:"current",lastUpdatedAt:1710357111,formattedLastUpdatedAt:"Mar 13, 2024",sidebarPosition:2,frontMatter:{title:"Removing and Tightening IAM Permissions",hide_title:!0,sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"KMS Support",permalink:"/cado-response/deploy/aws/iam/aws-kms"},next:{title:"Cross Account Creation",permalink:"/cado-response/deploy/aws/iam/cross-account-creation"}},c={},d=[{value:"Removing and Tightening IAM Permissions",id:"removing-and-tightening-iam-permissions",level:2},{value:"How to tighten IAM Permissions for SSM",id:"how-to-tighten-iam-permissions-for-ssm",level:2},{value:"Scoping down KMS Permissions if Required",id:"scoping-down-kms-permissions-if-required",level:2},{value:"KMS Consideration - Custom Keys",id:"kms-consideration---custom-keys",level:3},{value:"KMS Considerations - Cross Region / Cross Account",id:"kms-considerations---cross-region--cross-account",level:3}];function l(e){const n={a:"a",br:"br",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h2,{id:"removing-and-tightening-iam-permissions",children:"Removing and Tightening IAM Permissions"}),"\n",(0,o.jsxs)(n.p,{children:["You can further tune the IAM permissions that Cado deploys if you do not require all functionality. We describe the functionality used by the permissions in the \u201cSid\u201d section of the ",(0,o.jsx)(n.a,{href:"https://cado-public.s3.amazonaws.com/policy-in-cross-account.json",children:"cross-account role"}),". Please contact ",(0,o.jsx)(n.a,{href:"mailto:support@cadosecurity.com",children:"support@cadosecurity.com"})," for advice on what permissions are required for."]}),"\n",(0,o.jsx)(n.h2,{id:"how-to-tighten-iam-permissions-for-ssm",children:"How to tighten IAM Permissions for SSM"}),"\n",(0,o.jsx)(n.p,{children:"The Cado platform uses AWS SSM to perform live captures of AWS EC2 systems - this provides for a faster mechanism than a full disk acquisition and can also collect process memory."}),"\n",(0,o.jsx)(n.p,{children:"However, the default IAM permissions will be too wide for many environments, as this provides the Cado platform with permission to execute any command on SSM enabled systems:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'{\n    "Sid": "RequiredForTriageAndRunCommand",\n    "Effect": "Allow",\n    "Action": [\n        "ssm:SendCommand",\n        "ssm:DescribeInstanceInformation"\n    ],\n    "Resource": [\n        "arn:aws:ec2:*:*:instance/*",\n        "arn:aws:ssm:*::document/AWS-RunShellScript",\n        "arn:aws:ssm:*::document/AWS-RunPowerShellScript"\n    ]\n}\n'})}),"\n",(0,o.jsx)(n.p,{children:"You may wish to scope these permissions down, so SSM commands can only be run against specific Instances. The easiest way to do this, is by adding a Tag Condition to the targeted EC2 resources:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'{\n        "Sid": "RequiredForTriageAndRunCommandTagged",\n        "Effect": "Allow",\n        "Action": [\n            "ssm:SendCommand",\n            "ssm:DescribeInstanceInformation"\n        ],\n        "Resource": [\n            "arn:aws:ec2:*:*:instance/*"\n        ],\n        "Condition": {\n            "StringLike": {\n                "ssm:resourceTag/CadoResponseSSMEnabled": [\n                    "True"\n                ]\n            }\n        }\n    },\n    {\n        "Sid": "RequiredForTriageAndRunCommandRun",\n        "Effect": "Allow",\n        "Action": [\n            "ssm:SendCommand",\n            "ssm:DescribeInstanceInformation"\n        ],\n        "Resource": [\n            "arn:aws:ssm:*::document/AWS-RunShellScript",\n            "arn:aws:ssm:*::document/AWS-RunPowerShellScript"\n        ]\n}\n'})}),"\n",(0,o.jsxs)(n.p,{children:["Then adding the tag to the specific EC2 you wish to access with SSM:\n",(0,o.jsx)(n.img,{alt:"IAM",src:s(8248).Z+"",width:"1662",height:"822"})]}),"\n",(0,o.jsxs)(n.p,{children:["If an EC2 you are acquiring with SSM does not have the required Tag, you will receive an error such as:\nAn error occurred (AccessDeniedException) when calling the SendCommand operation: User: xxx is not authorized to perform: ssm",":SendCommand"," on resource: i-xxx because no identity-based policy allows the ssm",":SendCommand"," action"]}),"\n",(0,o.jsx)(n.h2,{id:"scoping-down-kms-permissions-if-required",children:"Scoping down KMS Permissions if Required"}),"\n",(0,o.jsxs)(n.p,{children:["The Cado platform will import EC2 instances with encrypted volumes, provided that the appropriate permissions are given to the CadoResponseRole.",(0,o.jsx)(n.br,{}),"\n","This is granted by the default Cado IAM roles.\nAWS provides default keys in each AWS account. The default Cado IAM permissions support decryption of these KMS keys out of the box.\nCado supports Custom KMS Keys as well"]}),"\n",(0,o.jsx)(n.h3,{id:"kms-consideration---custom-keys",children:"KMS Consideration - Custom Keys"}),"\n",(0,o.jsx)(n.p,{children:"When using custom keys the required actions to the CadoResponseRole are:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'"kms:Encrypt",\n"kms:Decrypt",\n"kms:ReEncrypt*",\n"kms:GenerateDataKey*",\n"kms:CreateGrant"\n'})}),"\n",(0,o.jsxs)(n.p,{children:["You may choose to forgo giving all the permissions and only provide kms",":CreateGrant"," to the CadoResponseRole.\nThis is recommended if the goal is simplicity, especially when there are cross account or cross region considerations.\nGrants will be created and retired as required by the platform."]}),"\n",(0,o.jsx)(n.p,{children:"You can give required permissions to the CadoResponseRole directly and withhold CreateGrant for resources only"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["You may not wish to give kms",":CreateGrant"," permission to the CadoResponseRole itself"]}),"\n",(0,o.jsx)(n.li,{children:"Your policy must feature a statement which provides access to the CadoResponseRole with the above permissions (except CreateGrant)"}),"\n",(0,o.jsx)(n.li,{children:"You may then tighten the policy to only allow CreateGrant permission to only certain AWS resources"}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"kms-considerations---cross-region--cross-account",children:"KMS Considerations - Cross Region / Cross Account"}),"\n",(0,o.jsxs)(n.p,{children:["Ensure that your relevant policy statements still apply to the region of your Cado platform (e.g. that policy Conditions don't preclude the platform's access).\nFor Cross Account, the simplest approach is to give kms",":CreateGrant",' permissions to the role being assumed in the target account.\nAlternatively the permissions in Custom Keys section are still valid, however both the primary and secondary account roles need to be accessible principals to "kms',":Encrypt",'", "kms',":Decrypt",'", "kms',":ReEncrypt",'*", kms',":GenerateDataKey",'*"']})]})}function m(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},8248:(e,n,s)=>{s.d(n,{Z:()=>o});const o=s.p+"assets/images/ssm_tag-2de7a9a0e47b507498f19f3d125fdf16.png"},1151:(e,n,s)=>{s.d(n,{Z:()=>a,a:()=>r});var o=s(7294);const i={},t=o.createContext(i);function r(e){const n=o.useContext(t);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),o.createElement(t.Provider,{value:n},e.children)}}}]);